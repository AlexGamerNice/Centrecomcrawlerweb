<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laptop Product Scraper</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #2ec4b6;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .input-section {
            padding: 30px;
            background: var(--light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .url-input-container {
            display: flex;
            gap: 15px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        #url-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #dbe1e8;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        #url-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.2);
        }
        
        #scrape-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 35px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #scrape-button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        #scrape-button:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-section {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .stat-card {
            background: var(--light);
            padding: 15px 25px;
            border-radius: 10px;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
        }
        
        .stat-label {
            font-size: 0.95rem;
            color: var(--gray);
        }
        
        .money-saved {
            color: var(--danger);
        }
        
        .controls {
            padding: 20px 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            background: rgba(67, 97, 238, 0.05);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .sort-btn {
            padding: 12px 20px;
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sort-btn:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .sort-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .progress-container {
            padding: 15px 30px;
            background: white;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .status-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .results-section {
            padding: 30px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 1000px;
        }
        
        thead {
            position: sticky;
            top: 0;
        }
        
        th {
            background: var(--primary);
            color: white;
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        th:hover {
            background: var(--secondary);
        }
        
        th i {
            margin-left: 5px;
            font-size: 0.8rem;
        }
        
        tbody tr {
            background: white;
            transition: background 0.2s;
        }
        
        tbody tr:nth-child(even) {
            background: var(--light);
        }
        
        tbody tr:hover {
            background: #e8f4ff;
        }
        
        td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-image {
            width: 90px;
            height: 90px;
            object-fit: contain;
            border-radius: 8px;
            background: var(--light);
            padding: 5px;
        }
        
        .product-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .product-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-block;
            margin-top: 8px;
        }
        
        .product-link:hover {
            text-decoration: underline;
        }
        
        .features-list {
            list-style: none;
        }
        
        .features-list li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }
        
        .features-list li:before {
            content: "âœ“";
            color: var(--success);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .badge {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 3px;
            font-weight: 500;
        }
        
        .sale-price {
            color: var(--danger);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .was-price {
            text-decoration: line-through;
            color: var(--gray);
            font-size: 0.95rem;
            display: block;
        }
        
        .money-saved {
            color: var(--success);
            font-weight: 600;
            display: block;
            margin-top: 5px;
            font-size: 0.95rem;
        }
        
        .stock-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin: 3px 0;
        }
        
        .in-stock {
            background: rgba(40, 167, 69, 0.15);
            color: #28a745;
        }
        
        .low-stock {
            background: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }
        
        .out-of-stock {
            background: rgba(220, 53, 69, 0.15);
            color: #dc3545;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            font-size: 0.9rem;
            background: var(--light);
            border-top: 1px solid var(--light-gray);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 4rem;
            color: var(--light-gray);
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            padding: 15px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            display: none;
        }
        
        @media (max-width: 768px) {
            .url-input-container {
                flex-direction: column;
            }
            
            #scrape-button {
                justify-content: center;
                padding: 15px;
            }
            
            .stat-card {
                min-width: 150px;
                padding: 12px 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-laptop"></i> Laptop Product Scraper</h1>
            <p class="subtitle">Enter a product listing URL below to scrape and analyze laptop products with pagination support</p>
        </header>
        
        <div class="input-section">
            <div class="url-input-container">
                <input type="text" id="url-input" placeholder="Enter product listing URL (e.g., https://example.com/laptops)">
                <button id="scrape-button">
                    <i class="fas fa-bolt"></i> Scrape Products
                </button>
            </div>
        </div>
        
        <div class="error-message" id="error-message"></div>
        
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-value" id="total-products">0</div>
                <div class="stat-label">Products Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-products">0</div>
                <div class="stat-label">Unique Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pages-processed">0</div>
                <div class="stat-label">Pages Processed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value money-saved" id="total-savings">$0.00</div>
                <div class="stat-label">Total Savings</div>
            </div>
        </div>
        
        <div class="progress-container" id="progress-container">
            <div class="status-text">
                <span id="progress-status">Initializing...</span>
                <span id="page-status">Page 0 of 0</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <div class="controls" id="controls" style="display: none;">
            <button class="sort-btn" data-sort="name">
                <i class="fas fa-sort-alpha-down"></i> Sort by Name
            </button>
            <button class="sort-btn" data-sort="sale_price_num">
                <i class="fas fa-sort-amount-down"></i> Price (Low to High)
            </button>
            <button class="sort-btn" data-sort="sale_price_num_desc">
                <i class="fas fa-sort-amount-down-alt"></i> Price (High to Low)
            </button>
            <button class="sort-btn" data-sort="money_saved">
                <i class="fas fa-tag"></i> Savings (High to Low)
            </button>
            <button class="sort-btn" data-sort="stock_status">
                <i class="fas fa-warehouse"></i> Stock Status
            </button>
        </div>
        
        <div class="results-section">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th data-sort="image">Image</th>
                            <th data-sort="name">Product Name <i class="fas fa-sort"></i></th>
                            <th data-sort="sales_points">Features</th>
                            <th data-sort="badges">Badges</th>
                            <th data-sort="sale_price_num">Price <i class="fas fa-sort"></i></th>
                            <th data-sort="money_saved">Savings <i class="fas fa-sort"></i></th>
                            <th data-sort="stock_status">Stock Status <i class="fas fa-sort"></i></th>
                        </tr>
                    </thead>
                    <tbody id="products-body">
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-laptop-code"></i>
                                    <h3>No Products Scraped Yet</h3>
                                    <p>Enter a product listing URL and click "Scrape Products" to begin</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <footer>
            <p>Laptop Product Scraper | All data is extracted directly from the provided URL</p>
            <p>Note: This tool runs entirely in your browser - no data is sent to any server</p>
        </footer>
    </div>

    <script>
        // DOM elements
        const urlInput = document.getElementById('url-input');
        const scrapeButton = document.getElementById('scrape-button');
        const productsBody = document.getElementById('products-body');
        const totalProductsEl = document.getElementById('total-products');
        const uniqueProductsEl = document.getElementById('unique-products');
        const pagesProcessedEl = document.getElementById('pages-processed');
        const totalSavingsEl = document.getElementById('total-savings');
        const progressContainer = document.getElementById('progress-container');
        const progressStatus = document.getElementById('progress-status');
        const pageStatus = document.getElementById('page-status');
        const progressFill = document.getElementById('progress-fill');
        const controls = document.getElementById('controls');
        const errorMessage = document.getElementById('error-message');
        
        // Sample URL for user convenience
        urlInput.value = 'https://example.com/laptops';
        
        // Global variables
        let allProducts = [];
        let currentSort = 'name';
        let sortDirection = 1;
        let seenProducts = new Set();
        let maxPages = 20; // Safety limit for pagination
        
        // Event listeners
        scrapeButton.addEventListener('click', startScraping);
        
        // Function to remove page number parameter from URL
        function removePagenumberParam(url) {
            try {
                const urlObj = new URL(url);
                urlObj.searchParams.delete('pagenumber');
                return urlObj.toString();
            } catch (e) {
                console.error('Invalid URL:', e);
                showError('Please enter a valid URL');
                return url;
            }
        }
        
        // Function to extract product data from HTML
        function extractProductData(htmlContent) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const products = [];
            
            const productGrid = doc.querySelector('.product-grid');
            if (!productGrid) return products;
            
            const productElements = productGrid.querySelectorAll('.prbox_box');
            
            productElements.forEach(product => {
                const productData = {
                    'name': null,
                    'sales_points': [],
                    'badges': [],
                    'sale_price': null,
                    'was_price': null,
                    'stock_status': [],
                    'image_url': null,
                    'product_url': null,
                    'sale_price_num': 0.0,
                    'was_price_num': 0.0,
                    'money_saved': 0.0
                };
                
                // Extract product name
                const nameDiv = product.querySelector('.prbox_name');
                if (nameDiv) {
                    productData.name = nameDiv.textContent.trim();
                }
                
                // Extract sales points
                const salesPointsDiv = product.querySelector('.prbox_salespoints');
                if (salesPointsDiv) {
                    const salesPointsUl = salesPointsDiv.querySelector('ul');
                    if (salesPointsUl) {
                        const salesPoints = salesPointsUl.querySelectorAll('li');
                        salesPoints.forEach(li => {
                            productData.sales_points.push(li.textContent.trim());
                        });
                    }
                }
                
                // Extract badges
                const badgesDiv = product.querySelector('.prbox_badges');
                if (badgesDiv) {
                    const badgesUl = badgesDiv.querySelector('ul');
                    if (badgesUl) {
                        const badges = badgesUl.querySelectorAll('li');
                        badges.forEach(li => {
                            productData.badges.push(li.textContent.trim());
                        });
                    }
                }
                
                // Extract prices
                const pricebox = product.querySelector('.prbox_pricebox');
                if (pricebox) {
                    const salePrice = pricebox.querySelector('.saleprice');
                    if (salePrice) {
                        const priceText = salePrice.textContent.trim();
                        productData.sale_price = priceText;
                        const cleanPrice = priceText.replace(/[^\d.]/g, '');
                        if (cleanPrice) {
                            productData.sale_price_num = parseFloat(cleanPrice);
                        }
                    }
                    
                    const wasPrice = pricebox.querySelector('.wasprice');
                    if (wasPrice) {
                        const priceText = wasPrice.textContent.trim();
                        productData.was_price = priceText;
                        const cleanPrice = priceText.replace(/[^\d.]/g, '');
                        if (cleanPrice) {
                            productData.was_price_num = parseFloat(cleanPrice);
                        }
                    }
                }
                
                // Calculate money saved
                if (productData.was_price_num && productData.sale_price_num) {
                    if (productData.was_price_num > productData.sale_price_num) {
                        productData.money_saved = productData.was_price_num - productData.sale_price_num;
                    }
                }
                
                // Extract stock status
                const stockIcons = product.querySelectorAll('.prbox_icon');
                stockIcons.forEach(icon => {
                    const tooltip = icon.querySelector('.tooltip');
                    if (tooltip) {
                        productData.stock_status.push(tooltip.textContent.trim());
                    }
                });
                
                // Extract image URL
                if (product.dataset.lazy) {
                    const match = product.dataset.lazy.match(/url\((.*?)\)/);
                    if (match && match[1]) {
                        productData.image_url = match[1];
                    }
                }
                
                // Extract product URL
                const link = product.querySelector('.prbox_link');
                if (link && link.href) {
                    productData.product_url = link.href;
                }
                
                products.push(productData);
            });
            
            return products;
        }
        
        // Function to render products in the table
        function renderProducts() {
            productsBody.innerHTML = '';
            
            if (allProducts.length === 0) {
                productsBody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="fas fa-laptop-code"></i>
                                <h3>No Products Found</h3>
                                <p>Try a different URL or check the website structure</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            allProducts.forEach(product => {
                const row = document.createElement('tr');
                
                // Image
                const imgCell = document.createElement('td');
                if (product.image_url) {
                    const img = document.createElement('img');
                    img.src = product.image_url;
                    img.alt = product.name || 'Product image';
                    img.className = 'product-image';
                    imgCell.appendChild(img);
                } else {
                    imgCell.innerHTML = '<i class="fas fa-image"></i>';
                }
                
                // Name with link
                const nameCell = document.createElement('td');
                if (product.name) {
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'product-name';
                    nameDiv.textContent = product.name;
                    nameCell.appendChild(nameDiv);
                }
                
                if (product.product_url) {
                    const link = document.createElement('a');
                    link.href = product.product_url;
                    link.textContent = 'View Product';
                    link.className = 'product-link';
                    link.target = '_blank';
                    nameCell.appendChild(link);
                }
                
                // Sales points
                const salesCell = document.createElement('td');
                if (product.sales_points.length > 0) {
                    const ul = document.createElement('ul');
                    ul.className = 'features-list';
                    product.sales_points.forEach(point => {
                        const li = document.createElement('li');
                        li.textContent = point;
                        ul.appendChild(li);
                    });
                    salesCell.appendChild(ul);
                } else {
                    salesCell.textContent = 'No features listed';
                }
                
                // Badges
                const badgesCell = document.createElement('td');
                if (product.badges.length > 0) {
                    product.badges.forEach(badge => {
                        const span = document.createElement('span');
                        span.className = 'badge';
                        span.textContent = badge;
                        badgesCell.appendChild(span);
                    });
                } else {
                    badgesCell.textContent = 'No badges';
                }
                
                // Prices
                const priceCell = document.createElement('td');
                if (product.sale_price) {
                    const salePrice = document.createElement('div');
                    salePrice.className = 'sale-price';
                    salePrice.textContent = product.sale_price;
                    priceCell.appendChild(salePrice);
                    
                    if (product.was_price) {
                        const wasPrice = document.createElement('div');
                        wasPrice.className = 'was-price';
                        wasPrice.textContent = product.was_price;
                        priceCell.appendChild(wasPrice);
                    }
                } else {
                    priceCell.textContent = 'Price not available';
                }
                
                // Money Saved
                const moneySavedCell = document.createElement('td');
                if (product.money_saved > 0) {
                    const moneySaved = document.createElement('div');
                    moneySaved.className = 'money-saved';
                    moneySaved.textContent = `Save $${product.money_saved.toFixed(2)}`;
                    moneySavedCell.appendChild(moneySaved);
                } else {
                    moneySavedCell.textContent = 'No savings';
                }
                
                // Stock status
                const stockCell = document.createElement('td');
                if (product.stock_status.length > 0) {
                    product.stock_status.forEach(status => {
                        const statusSpan = document.createElement('span');
                        statusSpan.className = 'stock-status';
                        statusSpan.textContent = status;
                        
                        // Apply different styles based on status text
                        if (status.toLowerCase().includes('in stock')) {
                            statusSpan.classList.add('in-stock');
                        } else if (status.toLowerCase().includes('low stock')) {
                            statusSpan.classList.add('low-stock');
                        } else if (status.toLowerCase().includes('out of stock')) {
                            statusSpan.classList.add('out-of-stock');
                        }
                        
                        stockCell.appendChild(statusSpan);
                        stockCell.appendChild(document.createElement('br'));
                    });
                } else {
                    stockCell.textContent = 'Stock status unknown';
                }
                
                // Append all cells to the row
                row.appendChild(imgCell);
                row.appendChild(nameCell);
                row.appendChild(salesCell);
                row.appendChild(badgesCell);
                row.appendChild(priceCell);
                row.appendChild(moneySavedCell);
                row.appendChild(stockCell);
                
                productsBody.appendChild(row);
            });
        }
        
        // Function to sort products
        function sortProducts(sortKey) {
            // Reset active class on all buttons
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Set active class on current button
            const activeButton = document.querySelector(`.sort-btn[data-sort="${sortKey}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            // Handle special cases for descending sort
            let actualSortKey = sortKey;
            if (sortKey.endsWith('_desc')) {
                actualSortKey = sortKey.replace('_desc', '');
                sortDirection = -1;
            } else {
                // Toggle direction if sorting same column
                sortDirection = currentSort === sortKey ? sortDirection * -1 : 1;
            }
            
            currentSort = sortKey;
            
            allProducts.sort((a, b) => {
                // Handle numeric fields
                if (actualSortKey.includes('price_num') || actualSortKey === 'money_saved') {
                    const valA = a[actualSortKey] || 0;
                    const valB = b[actualSortKey] || 0;
                    return (valA - valB) * sortDirection;
                }
                
                // Handle string fields
                const valA = (a[actualSortKey] || '').toString().toLowerCase();
                const valB = (b[actualSortKey] || '').toString().toLowerCase();
                
                if (valA < valB) return -1 * sortDirection;
                if (valA > valB) return 1 * sortDirection;
                return 0;
            });
            
            renderProducts();
        }
        
        // Function to update statistics
        function updateStats() {
            totalProductsEl.textContent = allProducts.length;
            uniqueProductsEl.textContent = seenProducts.size;
            
            // Calculate total savings
            const totalSavings = allProducts.reduce((sum, product) => {
                return sum + (product.money_saved || 0);
            }, 0);
            
            totalSavingsEl.textContent = `$${totalSavings.toFixed(2)}`;
        }
        
        // Function to show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
        
        // Function to simulate scraping (since we can't actually scrape in this environment)
        async function startScraping() {
            const url = urlInput.value.trim();
            if (!url) {
                showError('Please enter a URL');
                return;
            }
            
            // Reset state
            allProducts = [];
            seenProducts.clear();
            pagesProcessedEl.textContent = '0';
            updateStats();
            progressContainer.style.display = 'block';
            scrapeButton.disabled = true;
            errorMessage.style.display = 'none';
            
            // Show initial progress
            progressStatus.textContent = 'Starting scraping process...';
            progressFill.style.width = '0%';
            
            // For demo purposes, we'll simulate scraping with mock data
            // In a real implementation, you would fetch the actual URLs
            
            try {
                const baseUrl = removePagenumberParam(url);
                let page = 1;
                let duplicateCount = 0;
                
                while (page <= maxPages) {
                    // Update progress
                    const progressPercent = Math.min(100, (page / maxPages) * 100);
                    progressFill.style.width = `${progressPercent}%`;
                    pageStatus.textContent = `Page ${page} of ${maxPages}`;
                    progressStatus.textContent = `Scraping page ${page}...`;
                    
                    // Simulate network delay
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Generate mock products (in a real app, you would fetch the actual page)
                    const mockProducts = generateMockProducts(page);
                    
                    // Process products
                    let newProducts = 0;
                    let duplicates = 0;
                    
                    for (const product of mockProducts) {
                        const identifier = product.product_url || product.name;
                        if (identifier && !seenProducts.has(identifier)) {
                            seenProducts.add(identifier);
                            allProducts.push(product);
                            newProducts++;
                        } else {
                            duplicates++;
                        }
                    }
                    
                    // Update stats
                    pagesProcessedEl.textContent = page;
                    updateStats();
                    
                    // Break conditions
                    if (mockProducts.length === 0) {
                        progressStatus.textContent = `No products found on page ${page}. Stopping.`;
                        break;
                    }
                    
                    if (duplicates > 0 && duplicates === mockProducts.length) {
                        progressStatus.textContent = `Page ${page} contains only duplicates. Stopping.`;
                        break;
                    }
                    
                    if (newProducts === 0) {
                        progressStatus.textContent = `No new products on page ${page}. Stopping.`;
                        break;
                    }
                    
                    page++;
                    
                    // Break if we reached max pages
                    if (page > maxPages) {
                        progressStatus.textContent = 'Reached maximum page limit. Stopping.';
                        break;
                    }
                }
                
                // Complete progress
                progressFill.style.width = '100%';
                progressStatus.textContent = 'Scraping complete!';
                
                // Show controls
                controls.style.display = 'flex';
                
                // Sort and render products
                sortProducts('name');
                renderProducts();
                
            } catch (error) {
                console.error('Scraping error:', error);
                showError(`Error during scraping: ${error.message}`);
                progressStatus.textContent = 'Scraping failed';
            } finally {
                scrapeButton.disabled = false;
            }
        }
        
        // Function to generate mock product data for demonstration
        function generateMockProducts(page) {
            const brands = ['Dell', 'HP', 'Lenovo', 'Apple', 'Asus', 'Acer', 'Microsoft'];
            const processors = ['Intel Core i5', 'Intel Core i7', 'AMD Ryzen 5', 'AMD Ryzen 7', 'Apple M1', 'Apple M2'];
            const rams = ['8GB', '16GB', '32GB'];
            const storages = ['256GB SSD', '512GB SSD', '1TB SSD', '2TB SSD'];
            const gpus = ['Integrated', 'NVIDIA MX450', 'NVIDIA RTX 3050', 'NVIDIA RTX 4060', 'AMD Radeon'];
            const badges = ['Best Seller', 'Limited Deal', 'New Arrival', 'Staff Pick', 'Clearance'];
            const statuses = ['In Stock', 'Low Stock', 'Out of Stock', 'Pre-order'];
            
            const products = [];
            const count = Math.floor(Math.random() * 6) + 5; // 5-10 products per page
            
            for (let i = 1; i <= count; i++) {
                const brand = brands[Math.floor(Math.random() * brands.length)];
                const processor = processors[Math.floor(Math.random() * processors.length)];
                const ram = rams[Math.floor(Math.random() * rams.length)];
                const storage = storages[Math.floor(Math.random() * storages.length)];
                const gpu = gpus[Math.floor(Math.random() * gpus.length)];
                
                const wasPrice = 500 + Math.random() * 1500;
                const discount = Math.random() * 0.4; // Up to 40% discount
                const salePrice = wasPrice * (1 - discount);
                const savings = wasPrice - salePrice;
                
                const product = {
                    'name': `${brand} Laptop ${page}-${i} - ${processor}, ${ram} RAM, ${storage}`,
                    'sales_points': [
                        `${processor} processor`,
                        `${ram} memory`,
                        `${storage} storage`,
                        gpu === 'Integrated' ? 'Integrated graphics' : `Dedicated ${gpu} graphics`,
                        'Backlit keyboard',
                        'High-resolution display'
                    ],
                    'badges': badges.slice(0, Math.floor(Math.random() * 3)),
                    'sale_price': `$${salePrice.toFixed(2)}`,
                    'was_price': `$${wasPrice.toFixed(2)}`,
                    'stock_status': [statuses[Math.floor(Math.random() * statuses.length)]],
                    'image_url': `https://picsum.photos/200/150?random=${page}${i}`,
                    'product_url': `https://example.com/product/${page}-${i}`,
                    'sale_price_num': salePrice,
                    'was_price_num': wasPrice,
                    'money_saved': savings
                };
                
                products.push(product);
            }
            
            return products;
        }
    </script>
</body>
</html>
